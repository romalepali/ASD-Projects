webpackJsonp([44],{idVB:function(t,e,n){"use strict";function i(t){return this.reverberation=t,this.audioContext(),this.input=this.audioContext().createGain(),this.connect(),this}function a(t,e){return this.url=t,this.audioBuffer=e,this.waveSampleRate=0,this}function o(t,e,n,i,a,o,r){this.done=!1,this.instrument=t,this.volume=e,this.meter=n,this.pitches=i,this.pattern=a,this.patternDuration64=0,this.decay=.9,r&&1*r==r&&(this.decay=r),this.delay=.001,o&&1*o==o&&(this.delay=o);for(var s=0;s<this.pattern.length;s++)this.patternDuration64=this.patternDuration64+this.pattern[s].duration64;return this.timeSize=60/this.meter/16,this}function r(t,e,n){return this.slope=.123,this.midi=e,this.isDrum=n,this.owner=t,this.samples=[],this.handlers=[],this._setup(),this}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var l=n("WdUK"),h=[];[4,8,16].forEach(function(t){return h.push(t,t+" triplet")});var p={down:"down",up:"up",pm:"p.m.",pause:"pause"},c={none:"none",accent:"accent",mute:"mute"},d=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},m={1:{stroke:p.down,effect:c.none},2:{stroke:p.down,effect:c.mute},3:{stroke:p.down,effect:c.accent},101:{stroke:p.up,effect:c.none},102:{stroke:p.up,effect:c.mute},103:{stroke:p.up,effect:c.accent},201:{stroke:p.pm,effect:c.none},202:{stroke:p.pause,effect:c.none}},f=function(t){return t.map(function(t){return d({},m[t.measure])})},v=[{midi:1001,sample:"_surikov/4f92",originalPitch:9200,keyRangeLow:0,keyRangeHigh:127,loopStart:96e3,loopEnd:97e3,coarseTune:0,fineTune:0},{midi:28,sample:"Muted Guitar/Muted Guitar-B2",originalPitch:4700,keyRangeLow:0,keyRangeHigh:47,loopStart:14227,loopEnd:14406,coarseTune:0,fineTune:10},{midi:28,sample:"Muted Guitar/Muted Guitar-B3",originalPitch:5900,keyRangeLow:48,keyRangeHigh:59,loopStart:2253,loopEnd:2341,coarseTune:0,fineTune:-22},{midi:28,sample:"Muted Guitar/Muted Guitar-D#4",originalPitch:6300,keyRangeLow:60,keyRangeHigh:63,loopStart:2358,loopEnd:2428,coarseTune:0,fineTune:-18},{midi:28,sample:"Muted Guitar/Muted Guitar-E4",originalPitch:6400,keyRangeLow:64,keyRangeHigh:88,loopStart:3176,loopEnd:3243,coarseTune:0,fineTune:-6},{midi:28,sample:"Muted Guitar/Muted Guitar-E6",originalPitch:6400,keyRangeLow:89,keyRangeHigh:127,loopStart:1176,loopEnd:1224,coarseTune:0,fineTune:-15},{midi:225,sample:"_surikov/25/F-2AMARTN6",originalPitch:5300,keyRangeLow:0,keyRangeHigh:42,loopStart:82134,loopEnd:91904,coarseTune:12,fineTune:12,palmMute:28,harmonic:1001},{midi:225,sample:"_surikov/25/G2AMARTN6",originalPitch:5400,keyRangeLow:43,keyRangeHigh:43,loopStart:107105,loopEnd:119680,coarseTune:12,fineTune:13,palmMute:28,harmonic:1001},{midi:225,sample:"_surikov/25/A2CMARTN6",originalPitch:4400,keyRangeLow:44,keyRangeHigh:45,loopStart:59231,loopEnd:71630,coarseTune:0,fineTune:21,palmMute:28,harmonic:1001},{midi:225,sample:"_surikov/25/B2AMARTN6",originalPitch:4600,keyRangeLow:46,keyRangeHigh:47,loopStart:52013,loopEnd:62464,coarseTune:0,fineTune:24,palmMute:28,harmonic:1001},{midi:225,sample:"_surikov/25/C3AMARTN6",originalPitch:4700,keyRangeLow:48,keyRangeHigh:48,loopStart:82881,loopEnd:93440,coarseTune:0,fineTune:26,palmMute:28,harmonic:1001},{midi:225,sample:"_surikov/25/D3AMARTN6",originalPitch:4900,keyRangeLow:49,keyRangeHigh:50,loopStart:69428,loopEnd:80448,coarseTune:0,fineTune:23,palmMute:28,harmonic:1001},{midi:225,sample:"_surikov/25/E3AMARTN6",originalPitch:5100,keyRangeLow:51,keyRangeHigh:52,loopStart:63855,loopEnd:74560,coarseTune:0,fineTune:21,palmMute:28,harmonic:1001},{midi:225,sample:"_surikov/25/F-3AMARTN6",originalPitch:5300,keyRangeLow:53,keyRangeHigh:54,loopStart:80947,loopEnd:90944,coarseTune:0,fineTune:19,palmMute:28,harmonic:1001},{midi:225,sample:"_surikov/25/G3AMARTN6",originalPitch:5400,keyRangeLow:55,keyRangeHigh:55,loopStart:64188,loopEnd:76032,coarseTune:0,fineTune:17,palmMute:28,harmonic:1001},{midi:225,sample:"_surikov/25/A3AMARTN6",originalPitch:5600,keyRangeLow:56,keyRangeHigh:57,loopStart:51429,loopEnd:61888,coarseTune:0,fineTune:25,palmMute:28,harmonic:1001},{midi:225,sample:"_surikov/25/B3AMARTN6",originalPitch:5800,keyRangeLow:58,keyRangeHigh:59,loopStart:45490,loopEnd:54784,coarseTune:0,fineTune:1,palmMute:28,harmonic:1001},{midi:225,sample:"_surikov/25/C4CMARTN6",originalPitch:5900,keyRangeLow:60,keyRangeHigh:60,loopStart:57908,loopEnd:68608,coarseTune:0,fineTune:15,palmMute:28,harmonic:1001},{midi:225,sample:"_surikov/25/D4AMARTN6",originalPitch:6100,keyRangeLow:61,keyRangeHigh:62,loopStart:48649,loopEnd:57664,coarseTune:0,fineTune:9,palmMute:28,harmonic:1001},{midi:225,sample:"_surikov/25/F-4CMARTN6",originalPitch:6500,keyRangeLow:63,keyRangeHigh:66,loopStart:55194,loopEnd:68096,coarseTune:0,fineTune:25,palmMute:28,harmonic:1001},{midi:225,sample:"_surikov/25/G4AMARTN6",originalPitch:6600,keyRangeLow:67,keyRangeHigh:72,loopStart:54219,loopEnd:64960,coarseTune:0,fineTune:40,palmMute:28,harmonic:1001},{midi:225,sample:"_surikov/25/D5BMARTN6",originalPitch:7300,keyRangeLow:73,keyRangeHigh:78,loopStart:52582,loopEnd:63360,coarseTune:0,fineTune:30,palmMute:28,harmonic:1001},{midi:225,sample:"_surikov/25/G5AMARTN6",originalPitch:7700,keyRangeLow:79,keyRangeHigh:127,loopStart:42358,loopEnd:53120,coarseTune:0,fineTune:-44,palmMute:28,harmonic:1001}],g=[{midi:2e3,sample:"_surikov/impulse_rev",volume:.15,compressor:!0,threshold:-3,knee:30,ratio:12,attack:.05,release:.08}];o.prototype.clear=function(){var t=this;t.done=!0;for(var e=0;e<t.instrument.handlers.length;e++)t.instrument.handlers[e].envelope&&(t.instrument.handlers[e].envelope.gain.cancelScheduledValues(0),t.instrument.handlers[e].envelope.gain.value=101e-7,t.instrument.handlers[e].envelope.gain.setValueAtTime(123e-6,0),t.instrument.handlers[e].envelope.stopTime=0),t.instrument.handlers[e].free=!0},o.prototype.start=function(){var t=this;t.nextStart=t.instrument.owner.audioContext().currentTime,t.next(),t.nextStart=t.instrument.owner.audioContext().currentTime+t.patternDuration64*t.timeSize,t.tick()},o.prototype.next=function(){for(var t=this,e=0,n=0;n<t.pattern.length;n++){var i=t.volume;t.pattern[n].accent&&1*t.pattern[n].accent==t.pattern[n].accent&&(i*=t.pattern[n].accent);for(var a=0;a<t.pitches.length;a++){t.pattern[n].deadNotePlus||(i*=t.decay);var o=a;t.pattern[n].up&&(o=t.pitches.length-a-1);var r=t.pitches[o],s=!1;if(t.pattern[n].strings){s=!0;for(var u=0;u<t.pattern[n].strings.length;u++)if(t.pattern[n].strings[u]==o){s=!1;break}}if(!s){var l=a*t.delay;t.pattern[n].deadNotePlus&&(l=0);t.instrument.strum(t.nextStart+t.timeSize*e+l,i,r,t.timeSize*t.pattern[n].duration64,t.pattern[n].deadNote,t.pattern[n].palmMute,t.pattern[n].deadNotePlus)}}e+=t.pattern[n].duration64}},o.prototype.tick=function(){for(var t=this;t.instrument.owner.audioContext().currentTime+.1>t.nextStart;)t.next(),t.nextStart=t.nextStart+t.patternDuration64*t.timeSize;for(var e=0;e<t.instrument.handlers.length;e++){var n=t.instrument.handlers[e];n.free||n.stopTime<t.instrument.owner.audioContext().currentTime&&(n.audioBufferSourceNode&&(n.audioBufferSourceNode.stop(t.instrument.owner.audioContext().currentTime),n.audioBufferSourceNode.disconnect(),n.audioBufferSourceNode=null),n.free=!0)}t.done||setTimeout(function(){t.tick()},50)},i.prototype.instrumentCache=[],i.prototype.soundFontPath="",i.prototype.connect=function(){this.reverberation?(this.convolverInstrument=this.takeInstrument(2e3,!0),this.convolver=this.audioContext().createConvolver(),this.subGain=this.audioContext().createGain(),this.convolverGain=this.audioContext().createGain(),this.convolverGain.gain.value=this.reverberation,this.input.connect(this.subGain),this.subGain.connect(this.audioContext().destination),this.input.connect(this.convolverGain),this.convolverGain.connect(this.convolver),this.convolver.connect(this.audioContext().destination),this.needInitBuffer=!0):this.input.connect(this.audioContext().destination)},i.prototype.takeInstrument=function(t,e){for(var n=0;n<this.instrumentCache.length;n++)if(this.instrumentCache[n].midi==t&&this.instrumentCache[n].isDrum==e)return this.instrumentCache[n];var i=new r(this,t,e);return this.instrumentCache.push(i),i},i.prototype.safeURL=function(t){return t=t.replace(/\s/g,"_"),t=t.replace("&","%26"),t=t.replace("+","%2B"),t=t.replace("%","%25"),t=t.replace("#","%23")},i.prototype.readLENum=function(t,e,n){for(var i=t[e],a=e+1;a<e+n;a++)i+=256*t[a];return i},i.prototype.tick=function(){},i.prototype.loadArrayBuffer=function(t,e){var n=this,i=new XMLHttpRequest;i.responseType="arraybuffer",i.open("GET",this.safeURL(t),!0),i.onload=function(){if(4==i.readyState){var t=i.response,a=new Uint8Array(t),o=n.readLENum(a,24,2);e(t,o)}},i.onerror=function(t){e(null,0)},i.send()},i.prototype.loadAudioBuffer=function(t,e){var n=this;this.loadArrayBuffer(t,function(t,i){n.audioContext().decodeAudioData(t,function(t){e(t,i)},function(t){e(null,0)})})},i.prototype.audioContext=function(){if(window.ultimateAudioContext);else{var t=window.AudioContext||window.webkitAudioContext;window.ultimateAudioContext=new t}return window.ultimateAudioContext},i.prototype.ultimateWavesCache=function(){return window.ultimateWavesCache||(window.ultimateWavesCache=[]),window.ultimateWavesCache},i.prototype.addWaveToCache=function(t,e){for(var n=0;n<this.ultimateWavesCache().length;n++){var i=this.ultimateWavesCache()[n];if(i.url==t)return i.audioBuffer?void e():void this.loadAudioBuffer(t,function(t,n){i.audioBuffer=t,i.waveSampleRate=n,e()})}this.ultimateWavesCache().push(new a(t,null)),this.addWaveToCache(t,e)},i.prototype.realPath=function(t){return this.soundFontPath+t+".wav"},i.prototype.cacheAllWavesFrom=function(t,e){this.soundFontPath=t,this.cacheAllWaves(e)},i.prototype.cacheAllWaves=function(t){for(var e=[],n=0;n<this.instrumentCache.length;n++)if(this.instrumentCache[n])for(var i=0;i<this.instrumentCache[n].samples.length;i++)e.push(this.realPath(this.instrumentCache[n].samples[i].sample));var a=this,o=e.length;this.startFillWavesCache(e,o,function(){a.attachAllWaves(),t()})},i.prototype.startFillWavesCache=function(t,e,n){var i=this;if(t.length>0){var a=t.shift();this.addWaveToCache(a,function(){i.startFillWavesCache(t,e,n)})}else n()},i.prototype.findWave=function(t){for(var e=0;e<this.ultimateWavesCache().length;e++)if(this.ultimateWavesCache()[e].url==t)return this.ultimateWavesCache()[e];return null},i.prototype.attachAllWaves=function(){for(var t=0;t<this.instrumentCache.length;t++)if(this.instrumentCache[t])for(var e=0;e<this.instrumentCache[t].samples.length;e++)if(this.instrumentCache[t].samples[e].audioBuffer);else{var n=this.findWave(this.realPath(this.instrumentCache[t].samples[e].sample));this.instrumentCache[t].samples[e].wave=n}this.needInitBuffer&&(this.needInitBuffer=!0,this.convolver.buffer=this.convolverInstrument.samples[0].wave.audioBuffer)},r.prototype._setup=function(){if(this.samples.length<1)if(this.isDrum)for(var t=0;t<g.length;t++)g[t].midi==this.midi&&this.samples.push(g[t]);else for(var t=0;t<v.length;t++)v[t].midi==this.midi&&(this.samples.push(v[t]),v[t].harmonic&&(v[t].harmonicInstrument=this.owner.takeInstrument(v[t].harmonic,!1)),v[t].palmMute&&(v[t].palmMuteInstrument=this.owner.takeInstrument(v[t].palmMute,!1)),v[t].slap&&(v[t].slapInstrument=this.owner.takeInstrument(v[t].slap,!1)),v[t].pop&&(v[t].popInstrument=this.owner.takeInstrument(v[t].pop,!1)))},r.prototype.calculatePlayBackRate=function(t,e){var n=t.originalPitch-100*t.coarseTune-t.fineTune;return Math.pow(2,(100*e-n)/1200)},r.prototype.strumSampleRate=function(t,e,n,i){i.playbackRate.value=this.calculatePlayBackRate(e,t),i.playbackRate.cancelScheduledValues(this.owner.audioContext().currentTime)},r.prototype.queue=function(t,e,n,i,a,r){return new o(this,t,e,n,i,a,r)},r.prototype.createHandler=function(t,e,n){for(var i=null,a=0;a<this.handlers.length;a++)if(this.handlers[a].free){i=this.handlers[a];break}return i||(i={},i.envelope=this.owner.audioContext().createGain(),i.envelope.connect(this.owner.input),this.handlers.push(i)),0==n&&(n=1e-6),i.free=!1,i.stopTime=t+e+this.slope,i.audioBufferSourceNode=this.owner.audioContext().createBufferSource(),i.envelope.gain.cancelScheduledValues(0),i.envelope.gain.setValueAtTime(1e-6,this.owner.audioContext().currentTime),i.envelope.gain.setValueAtTime(1e-6,t),i.envelope.gain.linearRampToValueAtTime(n,t+.001),i.envelope.gain.setValueAtTime(n,t+e),i.envelope.gain.exponentialRampToValueAtTime(1e-6,t+e+this.slope/2),i.envelope.gain.setValueAtTime(1e-6,t+e+this.slope),i},r.prototype.strum=function(t,e,n,i,a,o,r){var t=t||this.owner.audioContext().currentTime+.1,s=null;if(s=o?this.findSample(n,o):this.findSample(n),s.wave){s.volume&&(sampleVolumeRatio=s.volume),(a||r)&&(i=.05);var u=this.createHandler(t,i,e);u.audioBufferSourceNode.buffer=s.wave.audioBuffer,s.loopStart>8&&s.loopStart<s.loopEnd&&s.loopEnd/s.wave.waveSampleRate<i+.3&&(u.audioBufferSourceNode.loop=!0,u.audioBufferSourceNode.loopStart=s.loopStart/s.wave.waveSampleRate,u.audioBufferSourceNode.loopEnd=s.loopEnd/s.wave.waveSampleRate),u.audioBufferSourceNode.connect(u.envelope),this.strumSampleRate(n,s,i,u.audioBufferSourceNode),u.audioBufferSourceNode.start(t,0,i+.1)}return u},r.prototype.findSample=function(t,e,n,i,a){for(var o=null,r=0;r<this.samples.length&&(o=this.samples[r],!(o.keyRangeLow<=t&&t<=o.keyRangeHigh));r++);if(o){if(e&&o.palmMuteInstrument)return o.palmMuteInstrument.findSample(t);if(n&&o.harmonicInstrument)return o.harmonicInstrument.findSample(t);if(i&&o.slapInstrument)return o.slapInstrument.findSample(t);if(a&&o.popInstrument)return o.popInstrument.findSample(t)}return o};var y=i,w=y,T=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},k=function(){function t(){s(this,t),this.CAN_PLAY=window.AudioContext||window.webkitAudioContext,this.queue=null,this.SOUNDBANK_PATH=UGAPP.config.static_server+"/plus/player/soundfonts/GeneralUserGs/",this.ACCENT=2.5,this.PITCHES=[45,52,57,61,64,69],this.VOLUME=.25,this.DELAY=.004,this.DECAY=1,this.is_loaded=!1,this.init()}return t.prototype.init=function(){this.CAN_PLAY&&(this.player=new w(.1),this.instrument=this.player.takeInstrument(225,!1))},t.prototype.play=function(t,e){var n=this;if(this.CAN_PLAY)return new Promise(function(i){n.is_loaded?(n.playStart(t,e),i()):n.player.cacheAllWavesFrom(n.SOUNDBANK_PATH,function(){n.is_loaded=!0,n.playStart(t,e),i()})})},t.prototype.playStart=function(t,e){this.stop(),this.queue=this.instrument.queue(this.VOLUME,2*t,this.PITCHES,e,this.DELAY,this.DECAY),this.queue.start()},t.prototype.stop=function(){this.CAN_PLAY&&this.queue&&this.queue.clear()},t.prototype.getBeats=function(t,e,n){var i=this,a=6e4/e/n*4,o=64/n*2,r=[],s=!0,u=t.map(function(t,e){return T({},i.convertBeat(t,o,a),{index:e})});return t.forEach(function(t){s&&t.stroke==p.pause?u.push(u.shift()):s=!1}),u.forEach(function(t){if(t.stroke==p.pause){var e=r[r.length-1];r[r.length-1]=T({},e,{duration64:e.duration64+t.duration64,durationMs:e.durationMs+t.durationMs})}else r.push(t)}),r},t.prototype.convertBeat=function(t,e,n){switch(t.stroke){case p.pm:t.deadNotePlus=!0;break;case p.up:t.up=!0}switch(t.effect){case c.accent:t.accent=this.ACCENT;break;case c.mute:t.deadNote=!0}return T({},t,{duration64:e,durationMs:n})},t}(),A=new k,C=n("0zBJ"),R=n.n(C),S=function(){function t(e,n){u(this,t),R()(this),this.index=n,this.isPlayed=!1,this.playIndex=-1,this.playCursor=-1,this.playTimeout=null,this.container=e,this.btnPlay=Object(l.a)(".js-listen",e),this.init()}return t.prototype.addEventListeners=function(){this.btnPlay.addEventListener("click",this.togglePlay.bind(this)),window.addEventListener("blur",this.tryStop.bind(this))},t.prototype.init=function(){if(window.AudioContext||window.webkitAudioContext){this.btnPlay.classList.remove("hide"),this.elBeats=Object(l.b)("strumm-beat",this.container);var t="1"===this.container.getAttribute("data-triplets");this.bpm=Math.round(+this.container.getAttribute("data-bpm")*(t?1.5:1));var e=f(this.elBeats.map(function(t){return{measure:t.getAttribute("data-beat")}})),n=this.container.getAttribute("data-denuminator");this.beats=A.getBeats(e,this.bpm,n),this.addEventListeners()}},t.prototype.tryStop=function(){this.isPlayed&&this.togglePlay()},t.prototype.togglePlay=function(){this.isPlayed?(this.stop(),A.stop()):this.play()},t.prototype.playStep=function(){this.playIndex<this.beats.length-1?this.playIndex+=1:this.playIndex=0,this.playCursor=this.beats[this.playIndex].index,this.highlightBeat(),this.playTimeout=setTimeout(this.playStep.bind(this),this.beats[this.playIndex].durationMs)},t.prototype.play=function(){var t=this,e=this.btnPlay;e.setAttribute("data-listen","2"),e.textContent=e.getAttribute("data-text-stop"),this.isPlayed=!0,setTimeout(function(){A.play(t.bpm,t.beats).then(function(){e.setAttribute("data-listen","1"),t.playStep(),t.trigger("play",t.index)})},100)},t.prototype.stop=function(){var t=this.btnPlay;t.setAttribute("data-listen","0"),t.textContent=t.getAttribute("data-text-listen"),this.isPlayed=!1,this.playIndex=-1,this.playCursor=-1,this.highlightBeat(),clearTimeout(this.playTimeout)},t.prototype.highlightBeat=function(){var t=this;this.elBeats.map(function(e,n){var i=t.playCursor==n?"add":"remove";e.classList[i]("active")})},t}(),P=Object(l.a)(".js-strumming-patterns");if(P){var M=Object(l.b)(".js-pattern",P),b=M.map(function(t,e){return new S(t,e)});b.map(function(t){return t.on("play",function(t){b.map(function(e){return t!=e.index&&e.stop()})})})}}});